name: ansible githook
on:
  push:
    branches:
      - production
    paths:
      - 'iac.yml'

jobs:
  automation_controller_job:
    runs-on: ubuntu-latest
    name: Kick off Automation controller job
    steps:
      - name: Load the ansible-cloud action
        id: controller_job
        uses: ansible-cloud/aap_controller_action@v1.2.8
        with:
          controller_host: ${{ secrets.CONTROLLER_HOST }}
          controller_username: ${{ secrets.CONTROLLER_USERNAME }}
          controller_password: ${{ secrets.CONTROLLER_PASSWORD }}
          job_template: "IAC Job Template"
          validate_certs: false
          extra_vars: "control_file=https://raw.githubusercontent.com/dcostakos/ansible_gitops_demo/production/iac.yml"
